[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Replication Code",
    "section": "",
    "text": "Show code\n# Load Packages\nlibrary(tidyverse)\nlibrary(lmtest)\nlibrary(sandwich)\nlibrary(fixest)\nlibrary(did)\nlibrary(panelView)\nlibrary(car)\nlibrary(showtext)\nlibrary(grid)\nlibrary(data.table)\nlibrary(FNN)\nlibrary(stringr)\nlibrary(plm)\nlibrary(scales)\nlibrary(modelsummary)\nlibrary(devtools)\nlibrary(foreign)\nlibrary(stargazer) \nlibrary(effectsize)\nlibrary(MASS)\nlibrary(marginaleffects)\nlibrary(broom)\nlibrary(readxl)\nlibrary(igraph)\nlibrary(tidygraph)\nlibrary(ggraph)\nlibrary(patchwork)\nlibrary(showtext)\n\n\n\n\nShow code\n# Function for cleaning the data (provided by GSS)\n read.dct &lt;- function(dct, labels.included = \"yes\") {\n      temp &lt;- readLines(dct)\n      temp &lt;- temp[grepl(\"_column\", temp)]\n      switch(labels.included,\n             yes = {\n                 pattern &lt;- \"_column\\\\(([0-9]+)\\\\)\\\\s+([a-z0-9]+)\\\\s+(.*)\\\\s+%([0-9]+)[a-z]\\\\s+(.*)\"\n                 classes &lt;- c(\"numeric\", \"character\", \"character\", \"numeric\", \"character\")\n                 N &lt;- 5\n                 NAMES &lt;- c(\"StartPos\", \"Str\", \"ColName\", \"ColWidth\", \"ColLabel\")\n             },\n             no = {\n                 pattern &lt;- \"_column\\\\(([0-9]+)\\\\)\\\\s+([a-z0-9]+)\\\\s+(.*)\\\\s+%([0-9]+).*\"\n                 classes &lt;- c(\"numeric\", \"character\", \"character\", \"numeric\")\n                 N &lt;- 4\n                 NAMES &lt;- c(\"StartPos\", \"Str\", \"ColName\", \"ColWidth\")\n             })\n      temp_metadata &lt;- setNames(lapply(1:N, function(x) {\n          out &lt;- gsub(pattern, paste(\"\\\\\", x, sep = \"\"), temp)\n          out &lt;- gsub(\"^\\\\s+|\\\\s+$\", \"\", out)\n          out &lt;- gsub('\\\"', \"\", out, fixed = TRUE)\n          class(out) &lt;- classes[x] ; out }), NAMES)\n      temp_metadata[[\"ColName\"]] &lt;- make.names(gsub(\"\\\\s\", \"\", temp_metadata[[\"ColName\"]]))\n      temp_metadata\n  }\n\n  read.dat &lt;- function(dat, metadata_var, labels.included = \"yes\") {\n      read.table(dat, col.names = metadata_var[[\"ColName\"]])\n  }\n\n# Load the data\nGSS_metadata &lt;- read.dct(\"~/Desktop/MA UC3M/TFM/OE/Juan Paper/result/GSS.dct\")\nGSS_ascii &lt;- read.dat(\"~/Desktop/MA UC3M/TFM/OE/Juan Paper/result/GSS.dat\", GSS_metadata)\nattr(GSS_ascii, \"col.label\") &lt;- GSS_metadata[[\"ColLabel\"]]\nGSS &lt;- GSS_ascii"
  },
  {
    "objectID": "index.html#create-weighted-network-measure",
    "href": "index.html#create-weighted-network-measure",
    "title": "Replication Code",
    "section": "Create Weighted Network Measure",
    "text": "Create Weighted Network Measure\n\n\nShow code\n# Weight networks by the intensity of contact\ndata3 &lt;- data3 |&gt;\n  rowwise() |&gt;\n  mutate(\n    weighted_cowork = if (!is.na(numgiven) && numgiven &gt; 0) {\n\n      cw &lt;- c(cowork1, cowork2, cowork3, cowork4, cowork5)[1:numgiven]\n      tk &lt;- c(talkto1, talkto2, talkto3, talkto4, talkto5)[1:numgiven]\n\n      num &lt;- sum(cw * tk, na.rm = TRUE)\n      den &lt;- sum(tk, na.rm = TRUE)\n\n      if (den &gt; 0) num / den else NA_real_\n\n    } else {\n      NA_real_\n    }\n  ) |&gt;\n  ungroup()"
  },
  {
    "objectID": "index.html#match-by-occ-10-titles",
    "href": "index.html#match-by-occ-10-titles",
    "title": "Replication Code",
    "section": "Match By OCC 10 titles",
    "text": "Match By OCC 10 titles\n\n\nShow code\n# Official Census 2010 occupation code list (with crosswalk file)\nocc_url &lt;- \"https://www2.census.gov/programs-surveys/demo/guidance/industry-occupation/2010-occ-codes-with-crosswalk-from-2002-2011.xls\"\n\ntmp &lt;- tempfile(fileext = \".xls\")\ndownload.file(occ_url, tmp, mode = \"wb\")\n\n# Read the Excel and keep the 2010 code + title columns\nocc_lu_raw &lt;- read_excel(tmp)\n\nocc10_lu &lt;- occ_lu_raw |&gt;\n  transmute(\n    occ10_code  = str_trim(as.character(`...3`)),\n    occ10_title = str_squish(as.character(`US Census Bureau`))\n  ) |&gt;\n  filter(str_detect(occ10_code, \"^\\\\d{4}$\")) |&gt;\n  mutate(\n    occ10_code = as.integer(occ10_code)\n  )\n\n# join onto your data \ndata3 &lt;- data3 |&gt;\n  left_join(occ10_lu, by = \"occ10_code\")"
  },
  {
    "objectID": "index.html#create-isco-1-digit-and-2-digit-labels",
    "href": "index.html#create-isco-1-digit-and-2-digit-labels",
    "title": "Replication Code",
    "section": "Create ISCO 1-Digit and 2-Digit Labels",
    "text": "Create ISCO 1-Digit and 2-Digit Labels\n\n\nShow code\n# BY 1-DIGIT OCC CODE\nisco88_1digit &lt;- tibble::tribble(\n  ~isco1, ~isco1_title,\n  0, \"Armed forces\",\n  1, \"Legislators, senior officials and managers\",\n  2, \"Professionals\",\n  3, \"Technicians and associate professionals\",\n  4, \"Clerks\",\n  5, \"Service workers and shop and market sales workers\",\n  6, \"Skilled agricultural and fishery workers\",\n  7, \"Craft and related trades workers\",\n  8, \"Plant and machine operators and assemblers\",\n  9, \"Elementary occupations\"\n)\n\ndata3 &lt;- data3 |&gt;\n  left_join(isco88_1digit, by = \"isco1\")\n\n\n\n# BY 2-DIGIT OCC CODE\n# ISCO-88: 2-digit sub-major groups\nisco88_2digit &lt;- tibble::tribble(\n  ~isco2, ~isco2_title,\n  11, \"Legislators and senior officials\",\n  12, \"Corporate managers\",\n  13, \"General managers\",\n  21, \"Physical, mathematical and engineering science professionals\",\n  22, \"Life science and health professionals\",\n  23, \"Teaching professionals\",\n  24, \"Other professionals\",\n  31, \"Physical and engineering science associate professionals\",\n  32, \"Life science and health associate professionals\",\n  33, \"Teaching associate professionals\",\n  34, \"Other associate professionals\",\n  41, \"Office clerks\",\n  42, \"Customer services clerks\",\n  51, \"Personal and protective services workers\",\n  52, \"Models, salespersons and demonstrators\",\n  61, \"Market-oriented skilled agricultural and fishery workers\",\n  62, \"Subsistence agricultural and fishery workers\",\n  71, \"Extraction and building trades workers\",\n  72, \"Metal, machinery and related trades workers\",\n  73, \"Precision, handicraft, craft printing and related trades workers\",\n  74, \"Other craft and related trades workers\",\n  81, \"Stationary-plant and related operators\",\n  82, \"Machine operators and assemblers\",\n  83, \"Drivers and mobile-plant operators\",\n  91, \"Sales and services elementary occupations\",\n  92, \"Agricultural, fishery and related labourers\",\n  93, \"Labourers in mining, construction, manufacturing and transport\"\n)\n\ndata3 &lt;- data3 |&gt;\n  left_join(isco88_2digit, by = \"isco2\")"
  },
  {
    "objectID": "index.html#create-egp-schema",
    "href": "index.html#create-egp-schema",
    "title": "Replication Code",
    "section": "Create EGP Schema",
    "text": "Create EGP Schema\n\n\nShow code\n# install once\ninstall.packages(\"remotes\")\nremotes::install_github(\"pdparker/isco88conversion\")\n\nlibrary(isco88conversion)\n\ndata3$EGP &lt;- isco88conversion::convert(data3$ISCO88, type = \"EGP\")\n\negp_labels &lt;- c(\n  \"Higher-grade service class\",\n  \"Lower-grade service class\",\n  \"Routine non-manual workers\",\n  \"Small proprietors (non-agricultural)\",\n  \"Lower technicians / skilled manual supervisors\",\n  \"Self-employed\",\n  \"Skilled manual workers\",\n  \"Semi- and unskilled manual workers\",\n  \"Agricultural workers\",\n  \"Farmers\",\n  \"Agricultural self-employed\"\n)\n\ndata3$EGP_title &lt;- factor(\n  data3$EGP,\n  levels = 1:11,\n  labels = egp_labels\n)"
  },
  {
    "objectID": "index.html#weighted-coworker-measure",
    "href": "index.html#weighted-coworker-measure",
    "title": "Replication Code",
    "section": "Weighted Coworker Measure",
    "text": "Weighted Coworker Measure\n\n\nShow code\ndata4 &lt;- data3 |&gt; \n  filter(work == 1)\n## OF THOSE WHO WORK\n# BY CLASS\ndata4 |&gt;\n  group_by(sub_class) |&gt;\n  summarise(\n    avg_prop_cowork = 100*mean(weighted_cowork, na.rm = TRUE),\n    n = n()\n  )\n# more of a working and middle class pheonomenon (in terms of self-reported class identity)\n\n# BY 1-DIGIT OCC CODE\ndata4 |&gt;\n  group_by(isco1_title) |&gt;\n  summarise(\n    avg_prop_cowork = 100*mean(weighted_cowork, na.rm = TRUE),\n    n = n()\n  ) |&gt; \n  arrange(desc(avg_prop_cowork))\n\n\n\nBy ISCO 2 Digit\n\n\nShow code\ndata4 |&gt;\n  group_by(isco2_title) |&gt;\n  summarise(\n    avg_prop_cowork = 100*mean(weighted_cowork, na.rm = TRUE),\n    n = n()\n  ) |&gt; \n    arrange(desc(avg_prop_cowork))\n\n\n\n\nBy OCC 10\n\n\nShow code\ndata4 |&gt;\n  group_by(occ10_title) |&gt;\n  summarise(\n    avg_prop_cowork = 100 * mean(weighted_cowork, na.rm = TRUE),\n    n = n(),\n    .groups = \"drop\"\n  ) |&gt;\n  arrange(desc(avg_prop_cowork))\n\n\n\n\nBy EGP\n\n\nShow code\ndata4 |&gt;\n  group_by(EGP_title) |&gt;\n  summarise(\n    avg_prop_cowork = 100*mean(weighted_cowork, na.rm = TRUE),\n    n = n()\n  ) |&gt; \n    arrange(desc(avg_prop_cowork))"
  },
  {
    "objectID": "index.html#perceptions-of-job-loss",
    "href": "index.html#perceptions-of-job-loss",
    "title": "Replication Code",
    "section": "Perceptions of Job Loss",
    "text": "Perceptions of Job Loss\n\n\nShow code\ndata4 &lt;- data3 |&gt; \n  filter(work == 1)\n# BY CLASS\ndata4 |&gt;\n  group_by(sub_class) |&gt;\n  summarise(\n    avg_prop_cowork = mean(joblike_lose, na.rm = TRUE),\n    n = n()\n  )\n# BY OCCUPATION\ndata3 |&gt;\n  group_by(occ_major) |&gt;\n  summarise(\n    avg_prop_cowork = mean(joblike_lose, na.rm = TRUE),\n    n = n()\n  )"
  },
  {
    "objectID": "index.html#robustness-checks",
    "href": "index.html#robustness-checks",
    "title": "Replication Code",
    "section": "Robustness Checks",
    "text": "Robustness Checks\n\n\nShow code\n# Test Heteroskedasticity\nbptest(m2) # not heteroskedastic\nbptest(m1) # not heteroskedastic"
  },
  {
    "objectID": "index.html#final-table",
    "href": "index.html#final-table",
    "title": "Replication Code",
    "section": "Final Table",
    "text": "Final Table\n\n\nShow code\n# define models\nmodels &lt;- list(\n   \"Job Loss\" = m1_pure,\n  \"Job Loss\" = m1a,\n  \"Job Loss\" = m1b,\n   \"Job Security\" = m2_pure,\n  \"Job Security\" = m2a,\n  \"Job Security\" = m2b\n)\n\n# define variable names\ncoef_map &lt;- c(\n  \"weighted_cowork\" = \"Weighted coworker share\",\n  \"female\" = \"Female\",\n  \"age\" = \"Age\",\n  \"I(age^2)\" = \"Age squared\",\n  \"educ\" = \"Education\",\n  \"marital\" = \"Married\",\n  \"CHILDS\" = \"Children\",\n  \"hsincome\" = \"Household income\",\n  \"race\" = \"Race\",\n  \"rural\" = \"Rural\",\n  \"union\" = \"Union member\",\n  \"work_govt\" = \"Government worker\",\n  \"hrs_week\" = \"Hours worked per week\",\n  \"born\" = \"US-born\",\n  \"partyid\" = \"Party ID\"\n)\n\n# table\nmodelsummary(\n  models,\n # vcov = vcovHC,\n  statistic = \"std.error\",\n  coef_rename = coef_map,\n  stars = TRUE,\n  gof_omit = \"IC|Log|Adj|F\",\n output = \"latex\"\n)\n\n\n\n\nShow code\n# Descriptive table\n# Extract data actually used in the model\nmf &lt;- model.frame(m1)\n\n# Descriptives for numeric variables\ndescriptives &lt;- data.frame(\n  N    = sapply(mf, function(x) sum(!is.na(x))),\n  Mean = sapply(mf, function(x) if (is.numeric(x)) mean(x, na.rm = TRUE) else NA),\n  SD   = sapply(mf, function(x) if (is.numeric(x)) sd(x, na.rm = TRUE) else NA),\n  Min  = sapply(mf, function(x) if (is.numeric(x)) min(x, na.rm = TRUE) else NA),\n  Max  = sapply(mf, function(x) if (is.numeric(x)) max(x, na.rm = TRUE) else NA)\n)\n\ndescriptives"
  }
]